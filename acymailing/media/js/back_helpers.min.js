"use strict";function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){c=!0,r=e},f:function(){try{o||null==a.return||a.return()}finally{if(c)throw r}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r,o,c=[],s=!0,l=!1;try{if(r=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;s=!1}else for(;!(s=(n=r.call(a)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){l=!0,i=e}finally{try{if(!s&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(l)throw i}}return c}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var acym_helperFilter={setFieldValue:function(e,t){if(e.hasClass("acym_select2_ajax")){var a=e.attr("data-ctrl");a||(a="dynamics");var n=e.attr("data-task");n||(n="trigger");var i=ACYM_AJAX_URL+"&ctrl="+a+"&task="+n+"&id="+encodeURIComponent(t),r=e.attr("data-params"),o=acym_helper.parseJson(r);i+="&"+jQuery.param(o),jQuery.get(i,function(t){if(t=acym_helper.parseJson(t),Array.isArray(t))t.map(function(t,a){var n=new Option(t.text,t.value,!1,!0);e.append(n).trigger("change")});else{var a=new Option(t.text,t.value,!0,!0);e.append(a).trigger("change")}})}else if("hidden"===e.attr("type")&&void 0!==e.attr("id")&&"delayvar"===e.attr("id").substring(0,8)){var c="second";t>=60&&t%60==0&&(c="minute",(t/=60)>=60&&t%60==0&&(c="hour",(t/=60)>=24&&t%24==0&&(c="day",(t/=24)>=7&&t%7==0&&(c="week",t/=7))));var s=e.attr("id").substring(8);jQuery("#delayvalue"+s).val(t),jQuery("#delaytype"+s).val(c).trigger("change")}else e.is(":checkbox")||void 0!==e.attr("data-switch")?e.is(":checkbox")&&1==t?e.prop("checked",!0):void 0!==e.attr("data-switch")&&e.val()!=t&&e.closest(".medium-3").find(".cell.switch-label").trigger("click"):e.val(t);void 0!==e.attr("data-rs")&&""!==t&&(-1!==t.indexOf("]")?jQuery('input[data-open="'+e.attr("data-rs")+'"]').val(t):jQuery('input[data-open="'+e.attr("data-rs")+'"]').val(moment.unix(t).format("DD MMM YYYY HH:mm")))},setAutomationReload:function(){jQuery("[acym-automation-reload]").each(function(){jQuery(this).on("change",function(){var e=jQuery(this);setTimeout(function(){var t=e.attr("acym-automation-reload"),a=acym_helper.parseJson(t);acym_helper.empty(a.plugin)||(a=[a]),a.forEach(function(e){var t={ctrl:"dynamics",task:"trigger",plugin:e.plugin,trigger:e.trigger};if(e.name&&(t.name=e.name,t.value=jQuery('[name="'+e.name+'"]').val()),e.params)for(var a=0,n=Object.entries(e.params);a<n.length;a++){var i=_slicedToArray(n[a],2),r=i[0],o=i[1];t[r]=o}if(e.paramFields)for(var c=0,s=Object.entries(e.paramFields);c<s.length;c++){var l=_slicedToArray(s[c],2),_=l[0],d=l[1];t[_]=jQuery('[name="'+d+'"]').val()}jQuery.ajax({type:"POST",url:ACYM_AJAX_URL,data:t,success:function(t){var a=jQuery(e.change);a.html(t),["segments","automation"].forEach(function(e){var t=".acym__"+e+"__one__filter.acym__"+e+"__one__filter__classic",n=".acym__"+e+"__inserted__filter input";n+=", .acym__"+e+"__inserted__filter textarea",n+=", .acym__"+e+"__inserted__filter select",a.closest(t).find(n).on("change acym-reloaded",function(){"segments"===e?acym_helperSegment.reloadCounters(a):jQuery.reloadCounters(a)}).trigger("acym-reloaded")}),acym_helperSelect2.setSelect2(),acym_helperSelect2.setAjaxSelect2(),acym_helperTooltip.setTooltip()}})})},100)})})},setToggle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"acym__automation__one__filter";if(e.length<1)return!0;var a=e.attr("data-acym-toggle-filter");if(void 0===a)return!0;(a=acym_helper.parseJson(a)).forEach(function(a){var n=e.closest(".".concat(t)).find(".".concat(a.class));acym_helperFilter.toggleBlock(e,n,a),e.on("change",function(){acym_helperFilter.toggleBlock(e,n,a)})})},toggleBlock:function(e,t,a){var n=t.find('[name*="[filters]"]');if(a.values.includes(e.val())){if(t.is(":visible"))return;return t.css("display","flex"),void n.attr("name","acym_action".concat(n.attr("name")))}t.hide(),n.attr("name",n.attr("name").replace("acym_action",""))}},acym_helperFlow={pathNumber:1,allLinks:[],allLinksElements:{},endLinksConditionByFrom:{},cardsCountLastRow:0,currentTransformValue:"",currentWidth:0,CARD_WIDTH_FOR_CONTAINER:500,ZOOM_STEP:.1,strokeWidth:"1px",strokeColor:"#A6A6A6",strokeDasharray:"3",slugLength:24,startTranslateX:0,undoFunction:null,redoFunction:null,listOfExistingSlugs:[],createFlow:function(e,t){var a=this,n=document.getElementById(t.id);n.querySelector("#flow__svg__container")&&(n.innerHTML=""),n.style.position="relative",this.pathNumber=1,this.allLinks=[],this.cardsCountLastRow=0,this.allLinksElements={},n.innerHTML='<div id="flow__container"></div>',n.innerHTML+=this.getToolboxHtml();var i=document.getElementById("flow__container");this.enableToolboxActions(i),i.innerHTML+='<div id="flow__svg__container"><svg id="flow__svg__container__svg"></svg></div>';var r=document.getElementById("flow__svg__container");i.innerHTML+='<div id="flow__tree__container">'.concat(this.createCard(e[0]),"</div>");var o=document.getElementById("flow__tree__container");void 0===e[0].children?(this.createLink(document.getElementById("flow__svg__container__svg"),e[0].slug),this.cardsCountLastRow++):this.iterate(e[0].children,!0,e[0].slug),document.getElementById("flow__tree__container").style.width="".concat(this.cardsCountLastRow*this.CARD_WIDTH_FOR_CONTAINER,"px"),this.connectCard(),i.style.width=o.offsetWidth+"px",i.style.height=o.offsetHeight+"px",i.style.transformOrigin="top left";var c=this.decryptTransform(this.currentTransformValue);this.currentWidth!==o.offsetWidth?this.startTranslateX=n.offsetWidth/2-o.offsetWidth/2:this.startTranslateX=c.x,this.currentWidth=o.offsetWidth,this.currentTransformValue?(this.editTransform("translate","".concat(this.startTranslateX,"px, ").concat(c.y,"px"),i),i.style.transform=this.currentTransformValue):(i.style.transform="translate(".concat(this.startTranslateX,"px, 0) scale(1)"),this.currentTransformValue="translate(".concat(this.startTranslateX,"px, 0) scale(1)")),this.dragFlow(n,i),this.scrollFlow(n,i),this.hoverAddButton(),document.querySelectorAll(".flow__step__card").forEach(function(e){e.addEventListener("click",function(a){a.target.classList.contains("flow__step__card__add")||"function"!=typeof t.cardClick||t.cardClick(e.closest(".flow__step__card__container").getAttribute("id"))})}),document.querySelectorAll(".flow__step__card__add").forEach(function(e){e.addEventListener("click",function(){"function"==typeof t.addButtonClick&&t.addButtonClick(e.closest(".flow__step__card__container").getAttribute("id"))})}),"function"==typeof t.undoFunction&&(this.undoFunction=t.undoFunction),"function"==typeof t.redoFunction&&(this.redoFunction=t.redoFunction),t.listOfExistingSlugs&&t.listOfExistingSlugs.length&&(this.listOfExistingSlugs=t.listOfExistingSlugs),window.onresize=function(){r.setAttribute("height","0"),r.setAttribute("width","0"),a.connectCard()}},connectCard:function(){for(var e=document.getElementById("flow__svg__container__svg"),t=0;this.allLinks.length>t;t++)void 0!==this.allLinks[t].end?this.connectElements(e,document.getElementById(this.allLinks[t].pathId),document.getElementById(this.allLinks[t].from),document.getElementById(this.allLinks[t].end)):this.endElements(e,document.getElementById(this.allLinks[t].pathId),document.getElementById(this.allLinks[t].from))},iterate:function(e,t,a){var n=document.getElementById("flow__svg__container__svg"),i=document.createElement("div");i.classList.add("flow__container__branch","from_".concat(a)),document.getElementById(a).after(i);var r=a;for(var o in e){var c=e[o],s=void 0===c.children||0===c.children.length;document.getElementById("card_".concat(c.slug))||(i.innerHTML+=this.createCard(c,!!c.conditionEnd&&c.conditionEnd,s)),(a&&!t||t)&&(this.createLink(n,a,c.slug),r=c.slug),void 0!==c.children&&c.children.length>0?this.iterate(c.children,!1,c.slug):(!0!==c.conditionEnd&&this.createLink(n,r),this.cardsCountLastRow++,r=a)}},connectElements:function(e,t,a,n){var i=document.getElementById("flow__svg__container");if(a.offsetTop>n.offsetTop){var r=a;a=n,n=r}var o=i.offsetTop,c=i.offsetLeft,s=a.offsetLeft+.5*a.offsetWidth-c,l=a.offsetTop+a.offsetHeight-o,_=n.offsetLeft+.5*n.offsetWidth-c,d=n.offsetTop-o;this.drawPath(e,t,s,l,_,d)},endElements:function(e,t,a){var n=document.getElementById("flow__svg__container"),i=n.offsetTop,r=n.offsetLeft,o=a.offsetLeft+.5*a.offsetWidth-r,c=a.offsetTop+a.offsetHeight-i,s=o,l=c+60;this.drawPath(e,t,o,c,s,l)},drawPath:function(e,t,a,n,i,r){var o=parseFloat(t.getAttribute("stroke-width"));e.getAttribute("height")<r&&e.setAttribute("height",r),e.getAttribute("width")<a+o&&e.setAttribute("width",a+o),e.getAttribute("width")<i+o&&e.setAttribute("width",i+o);var c=.15*(i-a),s=.15*(r-n),l=.5*(i-a),_=.5*(r-n),d=s<this.absolute(c)?s:this.absolute(c),m=_<this.absolute(l)?_:this.absolute(l),u=1;a>i&&(u=0);var h="M ".concat(a," ").concat(n," \n        V ").concat(n+m," \n        H ").concat(i-d*this.signum(c)," \n        A ").concat(d," ").concat(d," 0 0 ").concat(u," ").concat(i," ").concat(n+m+d," \n        V ").concat(r);t.setAttribute("d",h)},signum:function(e){return e<0?-1:1},absolute:function(e){return e<0?-e:e},createCard:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t?"flow__step__card__add--condition":"flow__step__card__add--straight",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"flow__step__container__end":"",i=e.condition?'<span class="flow__step__card__condition__yes">Yes</span><span class="flow__step__card__condition__no">No</span>':'<span class="flow__step__card__add '.concat(a,'">+</span>');return'<div class="flow__step__container '.concat(n,'">\n            <div class="flow__step__card__container ').concat(t?"flow__step__card__container__condition__end":"",'" id="').concat(e.slug,'">\n                <div id="card_').concat(e.slug,'" class="flow__step__card ').concat(t?"flow__step__card__container__end":"",'">').concat(e.html,"</div>\n                ").concat(i,"\n            </div>\n        </div>")},createLink:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n="path".concat(this.pathNumber),i='<path data-flow-from="'.concat(t,'" id="').concat(n,'" stroke="').concat(this.strokeColor,'" fill="none" stroke-width="').concat(this.strokeWidth,'" stroke-dasharray="').concat(this.strokeDasharray,'"></path>');return this.allLinks.push({pathId:n,from:t,end:a}),this.pathNumber++,e.innerHTML+=i,this.allLinksElements[t]||(this.allLinksElements[t]=[]),this.allLinksElements[t].push(document.getElementById(n)),n},decryptTransform:function(e){if(!e)return{x:0,y:0};var t=e.match(/translate\((.+?)\)/)[1].split(",");return{x:parseInt(t[0]),y:parseInt(t[1])}},dragFlow:function(e,t){var a=this,n=function(e){var n=a.decryptTransform(t.style.transform),i="".concat(n.x+e.movementX,"px, ").concat(n.y+e.movementY,"px");acym_helperFlow.editTransform("translate",i,t)};e.addEventListener("mousedown",function(e){e.target.classList.contains("flow__step__card__add")||2!==e.button&&(document.body.style.cursor="grabbing",window.addEventListener("mousemove",n),window.addEventListener("mouseup",function(){document.body.style.cursor="default",window.removeEventListener("mousemove",n)}))})},scrollFlow:function(e,t){var a=this;e.addEventListener("wheel",function(n){if(n.preventDefault(),0!==n.deltaY){var i=parseFloat(t.style.transform.match(/scale\((.+?)\)/)[1]),r=i+-.002*n.deltaY,o=Math.min(Math.max(.5,r),2);if(r===o){var c=a.decryptTransform(t.style.transform),s=n.clientX-e.getBoundingClientRect().left,l=n.clientY-e.getBoundingClientRect().top,_={x:s-(s-c.x)/i*o,y:l-(l-c.y)/i*o};acym_helperFlow.editTransform("scale",o,t);var d="".concat(_.x,"px, ").concat(_.y,"px");acym_helperFlow.editTransform("translate",d,t)}}})},editTransform:function(e,t,a){var n=new RegExp("".concat(e,"\\((.+?)\\)")),i=this.currentTransformValue.replace(n,"".concat(e,"(").concat(t,")"));a.style.transform=i,this.currentTransformValue=i},isSlugExist:function(e){return Object.keys(this.allLinksElements).includes(e)},updateNodeInFlow:function(e,t){for(var a in e){if(e[a].slug===t.slug){e[a].html=t.html,e[a].params=t.params;break}void 0!==e[a].children&&this.updateNodeInFlow(e[a].children,t)}},deleteNode:function(e,t){for(var a in e){if(e[a].slug===t)return void e.splice(a,1);void 0!==e[a].children&&(this.deleteNode(e[a].children,t),0===e[a].children.length&&delete e[a].children)}},addUpdateNewNode:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.isSlugExist(t.slug))this.updateNodeInFlow(e,t);else if(null===a)e.push(t);else for(var n in e){if(e[n].slug===a){void 0===e[n].children&&(e[n].children=[]),e[n].children.length&&(t.condition?t.children[0].children=_toConsumableArray(e[n].children):t.children=_toConsumableArray(e[n].children)),e[n].children=[t];break}void 0!==e[n].children&&this.addUpdateNewNode(e[n].children,t,a)}},createNode:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={html:'<div class="acym__flow__card__content"><i class="acymicon-'.concat(t,'"></i><p>').concat(e,"</p></div>"),slug:this.generateRandomString(this.slugLength),condition:a};return a&&(n.children=[{html:"",slug:this.generateRandomString(this.slugLength),conditionEnd:!0,conditionValid:!0},{html:"",slug:this.generateRandomString(this.slugLength),conditionEnd:!0,conditionValid:!1}]),n},generateRandomString:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",a="",n=0;n<e;n++){a+=t[Math.floor(Math.random()*t.length)]}return this.listOfExistingSlugs.includes(a)?this.generateRandomString(e):a},hoverAddButton:function(){var e=this;document.querySelectorAll(".flow__step__card__add").forEach(function(t){t.addEventListener("mouseenter",function(a){var n=t.closest(".flow__step__card__container").getAttribute("id");if(e.allLinksElements[n]&&e.allLinksElements[n].length){var i=e.allLinksElements[n][0],r=i.style.stroke;i.style.stroke="#00A4FF",t.addEventListener("mouseleave",function(){i.style.stroke=r})}})})},getToolboxHtml:function(){return'<div id="flow__toolbox">\n<div class="flow__toolbox__item" id="flow__toolbox__item__center"><i class="acymicon-checkbox-empty"></i></div>\n<div class="flow__toolbox__item" id="flow__toolbox__item__zoom-in"><i class="acymicon-add"></i></div>\n<div class="flow__toolbox__item" id="flow__toolbox__item__zoom-out"><i class="acymicon-minus"></i></div>\n<div class="flow__toolbox__item" id="flow__toolbox__item__undo"><i class="acymicon-rotate-left"></i></div>\n<div class="flow__toolbox__item" id="flow__toolbox__item__redo"><i class="acymicon-repeat"></i></div>\n</div>'},enableToolboxActions:function(e){this.toolboxZoomAction(e),this.toolboxCenterAction(e),this.setUndo(),this.setRedo()},toolboxCenterAction:function(e){var t=this;document.getElementById("flow__toolbox__item__center").addEventListener("click",function(){e.style.transform="translate(".concat(t.startTranslateX,"px, 0) scale(1)"),t.currentTransformValue="translate(".concat(t.startTranslateX,"px, 0) scale(1)")})},toolboxZoomAction:function(e){var t=this;document.getElementById("flow__toolbox__item__zoom-in").addEventListener("click",function(){var a=parseFloat(e.style.transform.match(/scale\((.+?)\)/)[1])+t.ZOOM_STEP;a=Math.min(Math.max(.5,a),2),t.editTransform("scale",a,e)}),document.getElementById("flow__toolbox__item__zoom-out").addEventListener("click",function(){var a=parseFloat(e.style.transform.match(/scale\((.+?)\)/)[1])-t.ZOOM_STEP;a=Math.min(Math.max(.5,a),2),t.editTransform("scale",a,e)})},setUndo:function(){var e=this;document.getElementById("flow__toolbox__item__undo").addEventListener("click",function(){e.undoFunction()})},setRedo:function(){var e=this;document.getElementById("flow__toolbox__item__redo").addEventListener("click",function(){e.redoFunction()})}},acym_helperHeader={setVersionButton:function(){var e=jQuery("#checkVersionButton");e.on("click",function(){var e=jQuery("#checkVersionArea");e.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>');var t=ACYM_AJAX_URL+"&ctrl=update&task=checkForNewVersion";jQuery.get(t,function(t){t=acym_helper.parseJson(t),e.html(t.data.content),jQuery("#acym__check__version__last__check").html(t.data.lastcheck),acym_helperTooltip.setTooltip()})}),1===e.data("check")&&e.trigger("click")}},acym_helperBack={setDoNotRemindMe:function(){jQuery("#acym__reviews__footer__link").on("click",function(){var e=ACYM_TOGGLE_URL+"&task=setDoNotRemindMe&value="+encodeURIComponent(jQuery(this).attr("title"));jQuery.post(e,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):jQuery("#acym__reviews__footer").html(e.message)})}),jQuery(".acym__do__not__remindme, .acym__do__not__remindme__multilingual").on("click",function(){var e=jQuery(this).attr("title");jQuery('[data-news="'+e+'"]').remove();var t=ACYM_TOGGLE_URL+"&task=setDoNotRemindMe&value="+encodeURIComponent(e);jQuery.post(t,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):location.reload()})}),jQuery("#acym__multilingual__reminder").on("click",function(){localStorage.setItem("acyconfiguration","languages")})}},acym_helperJoomla={setWidthJoomlaContent:function(){var e=jQuery("#acym__joomla__left-menu");if(e){var t=e.width();jQuery(window).width()<640?(t=0,e.css({display:"none"})):e.css({display:"block"}),jQuery("#acym_content, .acym_no_foundation").css({width:"calc(100% - "+t+"px)","margin-left":t+"px"}),jQuery("#system-message-container").css({"margin-left":t+15+"px"})}},setJoomlaLeftMenu:function(){var e=jQuery("#acym__joomla__left-menu"),t=jQuery("#acym__joomla__left-menu--toggle"),a=jQuery("#acym__joomla__left-menu a span"),n=jQuery("#acym__joomla__left-menu--toggle i");jQuery(".btn-subhead").hide(),"none"!=t.css("display")&&(e.hasClass("collapsed")?(a.hide(),e.css({width:"34px"}),n.removeClass("acymicon-keyboard-arrow-left").addClass("acymicon-keyboard-arrow-right")):(a.show(),e.css({width:"210px"}),n.removeClass("acymicon-keyboard-arrow-right").addClass("acymicon-keyboard-arrow-left")),acym_helperJoomla.setWidthJoomlaContent(),t.off("click").on("click",function(){e.hasClass("collapsed")?(e.removeClass("collapsed"),a.show(),e.css({width:"210px"}),n.removeClass("acymicon-keyboard-arrow-right").addClass("acymicon-keyboard-arrow-left"),acym_helper.setCookie("menuJoomla","",365)):(e.addClass("collapsed"),a.hide(),e.css({width:"34px"}),n.removeClass("acymicon-keyboard-arrow-left").addClass("acymicon-keyboard-arrow-right"),acym_helper.setCookie("menuJoomla","collapsed",365)),acym_helperJoomla.setWidthJoomlaContent()})),jQuery(".btn-navbar").off("click").on("click",function(){e.hide()}),jQuery("#acym__joomla__left-menu--show").off("click").on("click",function(){var t=jQuery(".btn-navbar");t.hasClass("collapsed")||(jQuery(".nav-collapse").css("height","0px").removeClass("in"),t.removeClass("collapsed")),e.toggle()}),jQuery(window).on("resize",function(){window.innerWidth<950&&!e.hasClass("collapsed")&&t.trigger("click"),acym_helperJoomla.setWidthJoomlaContent()})}},acym_helperMailer={setTestCredentialsSendingMethods:function(){jQuery(".acym__configuration__sending__method-test").off("click").on("click",function(){var e=this.getAttribute("sending-method-id");if(void 0===e)return!1;var t=jQuery(this).closest(".acym__sending__methods__credentials__test").find(".acym__configuration__sending__method-icon"),a=jQuery(this).closest(".acym__sending__methods__credentials__test").find(".acym__configuration__sending__method-test__message");t.removeClass("acym__color__red acym__color__green").addClass("acymicon-circle-o-notch acymicon-spin"),a.html("");for(var n={ctrl:"configuration",task:"testCredentialsSendingMethod",sendingMethod:this.getAttribute("sending-method-id")},i=jQuery(this).closest("#acym__configuration__sml__form").length>0,r=jQuery('[name^="'.concat(i?"sml":"config","[").concat(e,'"]')),o=0;o<r.length;o++){var c=r[o],s=c.getAttribute("name").replace("sml","config");"radio"!=c.getAttribute("type")?n[s]=c.value:c.checked&&(n[s]=c.value)}acym_helper.post(ACYM_AJAX_URL,n).then(function(e){var n;n=e.error?"acymicon-times-circle acym__color__red":"acymicon-check-circle acym__color__green",t.removeClass("acymicon-circle-o-notch acymicon-spin acymicon-check-circle acymicon-times-circle"),t.addClass(n),a.html(e.message)})})},setButtonCopyFromPlugin:function(){jQuery(".acym__configuration__copy__mail__settings").off("click").on("click",function(){var e=jQuery(this).closest("div").find(".acym__configuration__sending__method-icon");e.addClass("acymicon-circle-o-notch acymicon-spin");var t={plugin:jQuery(this).attr("acym-data-plugin"),method:jQuery(this).attr("acym-data-method")},a=ACYM_AJAX_URL+"&ctrl=configuration&task=copySettingsSendingMethod";acym_helper.post(a,t).then(function(e){if(e.error)return acym_helperNotification.addNotification(e.message,"error"),!1;for(var t=0,a=Object.entries(e.data);t<a.length;t++){var n=_slicedToArray(a[t],2),i=n[0],r=n[1],o=jQuery('[name="config['.concat(i,']"]'));0!==o.length&&(void 0!==o.attr("data-switch")&&o.val()!=r?o.closest(".switch").find(".switch-label").trigger("click"):"radio"===o.attr("type")?(o=jQuery('[name="config['.concat(i,']"][value="').concat(r.toLowerCase(),'"]'))).length>0&&o.trigger("click"):o.val(r).trigger("change"))}}).always(function(t){e.removeClass("acymicon-circle-o-notch acymicon-spin")})})},setSynchroExistingUsers:function(){jQuery(".acym__configuration__sending__synch__users").off("click").on("click",function(){var e=this.getAttribute("sending-method-id");if(void 0===e)return!1;var t=jQuery(this).closest(".acym__sending__methods__synch").find(".acym__configuration__sending__method-icon"),a=jQuery(this).closest(".acym__sending__methods__synch").find(".acym__configuration__sending__method-synch__message");t.removeClass("acym__color__red acym__color__green").addClass("acymicon-circle-o-notch acymicon-spin"),a.html("");var n={ctrl:"configuration",task:"synchronizeExistingUsers",sendingMethod:e};acym_helper.post(ACYM_AJAX_URL,n).then(function(e){var n;n=e.error?"acymicon-times-circle acym__color__red":"acymicon-check-circle acym__color__green",t.removeClass("acymicon-circle-o-notch acymicon-spin"),t.addClass(n),a.html(e.message)})})},acymailerAddDomains:function(){var e=jQuery("#acym__configuration__acymailer__add__error");jQuery("#acym__configuration__sending__method-addDomain").off("click").on("click",function(){e.hide();var t=jQuery("#acymailer_domain").val().trim();if(!acym_helper.empty(t)){var a={oneDomain:t,ctrl:"dynamics",task:"trigger",plugin:"plgAcymAcymailer",trigger:"ajaxAddDomain"},n=document.querySelector("#acym__configuration__sending__method_add_domain-wait");n.classList.remove("is-hidden"),acym_helper.post(ACYM_AJAX_URL,a).then(function(t){if(t.error)return jQuery("#acym__acymailer__unverifiedDomains").hide(),jQuery("#acym__configuration__acymailer__add__error__message").text(t.message),e.css("display","flex"),void n.classList.add("is-hidden");location.reload()})}})},displayCnameRecord:function(){jQuery("#acym_wrapper").on("click",".acym__sending__methods__unverifiedDomain-icon",function(){var e=jQuery(this).closest(".acym__sending__methods__container__oneUnverifiedDomain").find(".acym__sending__methods__unverifiedDomain"),t=acym_helper.parseJson(e[0].getAttribute("data-acym-cname")),a=jQuery("#acym__configuration__sending__method__cnameTable__container"),n=document.querySelectorAll(".cname-value"),i=document.querySelectorAll(".cname-name");for(var r in t)n[r].innerHTML=t[r].value,i[r].innerHTML=t[r].name;0===jQuery(".domain_selected").length?(a.slideToggle(),jQuery(this).addClass("domain_selected")):jQuery(this).hasClass("domain_selected")?(a.slideToggle(),jQuery(this).removeClass("domain_selected")):(jQuery(".acym__sending__methods__unverifiedDomain-icon").removeClass("domain_selected"),jQuery(this).addClass("domain_selected"))}),jQuery(".cname-name, .cname-value").on("click",function(){var e=document.createRange();e.selectNode(this),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)})},deleteDomain:function(){jQuery(".acym__config__acymailer__domain--delete").off("click").on("click",function(){var e=this;if(confirm(ACYM_JS_TXT.ACYM_DELETE_DOMAIN_CONFIRMATION)){this.classList.remove("acymicon-delete"),this.classList.add("acymicon-circle-o-notch","acymicon-spin");var t={oneDomain:jQuery(this).attr("acym-data-domain").trim(),ctrl:"dynamics",task:"trigger",plugin:"plgAcymAcymailer",trigger:"onAcymDeleteDomain"};acym_helper.post(ACYM_AJAX_URL,t).then(function(t){if(t.error)return e.classList.add("acymicon-delete"),e.classList.remove("acymicon-circle-o-notch","acymicon-spin"),void acym_helperNotification.addNotification(t.message,"error",!0);jQuery(e).closest(".acym__listing__row").remove(),jQuery(".acym__config__acymailer__status__icon.acymicon-access-time").length||jQuery(".acym__config__acymailer__warning").remove()})}})},domainSuggestion:function(){var e=jQuery("#acym__acymailer__unverifiedDomains"),t=jQuery("#acymailer_domain"),a=jQuery(".acym__acymailer__oneSuggestion"),n=jQuery("#acymailer_domain_error");e.hide(),t.off("click").on("click",function(){e.toggle(),e.is(":visible")?n.hide():n.show()}),jQuery.each(a,function(){jQuery(this).on("mouseenter",function(){jQuery(this).addClass("acym__acymailer__suggestion_selected")}),jQuery(this).on("mouseleave",function(){jQuery(this).removeClass("acym__acymailer__suggestion_selected")}),jQuery(this).off("click").on("click",function(){t.val(jQuery(this).html().trim()),e.hide()})})},updateStatus:function(){jQuery("#acym__config__acymailer__update-domain-status").on("click",function(){jQuery(".notValidated").replaceWith('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),acym_helper.get(ACYM_AJAX_URL,{sendingMethod:this.getAttribute("sending-method-id"),ctrl:"dynamics",task:"trigger",plugin:"plgAcymAcymailer",trigger:"ajaxCheckDomain"}).then(function(e){if(e.error){acym_helperNotification.addNotification(e.message,"error",!0);var t=jQuery('div[acym-data-domain="'.concat(e.data.domain,'"]'));return t.parent().find(".acymicon-spin").replaceWith('<i class="acym__config__acymailer__status__icon acymicon-close acym__color__red notValidated"></i>'),void t.find(".acym__tooltip__text").html(e.message)}var a="",n="";Object.entries(e.data.domains).forEach(function(e){var t=_slicedToArray(e,2),i=t[0];switch(t[1].status){case"SUCCESS":a="acymicon-check-circle acym__color__green",n=ACYM_JS_TXT.ACYM_VALIDATED;break;case"FAILED":a="acymicon-close acym__color__red notValidated",n=ACYM_JS_TXT.ACYM_APPROVAL_FAILED;break;default:a="acymicon-access-time acym__color__orange notValidated",n=ACYM_JS_TXT.ACYM_PENDING}var r=jQuery('div[acym-data-domain="'.concat(i,'"]'));r.find(".acymicon-spin").replaceWith('<i class="acym__config__acymailer__status__icon '+a+'"></i>'),r.find(".acym__tooltip__text").html(n)})})})}},acym_helperNotification={setNotificationCenter:function(){var e=jQuery(".acym__header__notification");e.find("i").hasClass("acymicon-check-circle")&&setTimeout(function(){e.find("> i").attr("class","acymicon-bell"),e.find(".acym__tooltip__text").remove(),e.removeAttr("data-acym-tooltip").removeAttr("data-acym-tooltip-position").removeClass("acym__header__notification__button__success acym__header__notification__pulse")},8e3),e.off("click").on("click",function(){acym_helperNotification.readFullNotification();var t=jQuery(this),a=jQuery(".acym__header__notification__center"),n=t.offset(),i=n.left-a.width()+t.width()+"px",r=n.top+t.height()+10+"px";a.css({top:r,left:i}).addClass("acym__header__notification__center__visible");var o=ACYM_AJAX_URL+"&ctrl=configuration&task=markNotificationRead";jQuery.post(o,function(e){jQuery(".acym__header__notification").removeClass("acym__header__notification__pulse acym__header__notification__button__success acym__header__notification__button__info acym__header__notification__button__warning acym__header__notification__button__error").find("> i").attr("class","acymicon-bell")}),e.off("click").on("click",function(e){if(jQuery(e.target).hasClass("acym__header__notification__center__visible")||jQuery(e.target).closest(".acym__header__notification__center__visible").length>0)return!0;acym_helperNotification.removeNotificationsCenter()}),setTimeout(function(){jQuery(window).off("click").on("click",function(e){if(jQuery(e.target).hasClass("acym__header__notification__center__visible")||jQuery(e.target).closest(".acym__header__notification__center__visible").length>0)return!0;acym_helperNotification.removeNotificationsCenter()})},100)}),jQuery(".acym__message__close").off("click").on("click",function(){var e=jQuery(this),t=e.attr("data-id");if(void 0!==t&&0!=t){var a=ACYM_AJAX_URL+"&ctrl=configuration&task=markNotificationRead&id="+t;jQuery.post(a,function(t){e.closest(".acym__message").remove()})}else e.closest(".acym__message").remove()})},removeNotifications:function(){jQuery(".acym__header__notification__one__delete, .acym__header__notification__toolbox__remove, .acym__dashboard__notification__delete, .acym__do__not__remindme").on("click",function(){var e=jQuery(this).hasClass("acym__dashboard__notification__delete")||jQuery(this).hasClass("acym__do__not__remindme"),t=jQuery(this).attr("data-id");t||(t=jQuery(this).attr("title"));var a=ACYM_AJAX_URL+"&ctrl=configuration&task=removeNotification&id="+t;jQuery.post(a,function(t){(t=acym_helper.parseJson(t)).error?console.log("Error removing notification:",t.message):(t.data.dashboardHtml.length>0?jQuery(".acym__dashboard__notifications").html(t.data.dashboardHtml):jQuery("#acym__dashboard__notifications").remove(),e||(jQuery(".acym__header__notification__center").html(t.data.headerHtml),jQuery(".acym__header__notification").find("> i").attr("class","acymicon-bell")))}),e||jQuery(".acym__header__notification").removeClass("acym__header__notification__pulse acym__header__notification__button__success acym__header__notification__button__info acym__header__notification__button__warning acym__header__notification__button__error").find("> i").attr("class","acymicon-bell")})},removeNotificationsCenter:function(){jQuery(".acym__header__notification__center").removeClass("acym__header__notification__center__visible"),jQuery(window).off("click"),acym_helperNotification.setNotificationCenter()},addNotification:function(e,t,a){void 0===a&&(a=!1),a&&jQuery(".acym__message").remove(),void 0!==t&&-1!=jQuery.inArray(t,["success","warning","error"])||(t="info");var n=acym_helperNotification.addHeaderNotification(e,t);jQuery("#acym_header").after(n);var i=ACYM_AJAX_URL+"&ctrl=configuration&task=addNotification&message="+e+"&level="+t;jQuery.post(i,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):(jQuery(".acym__header__notification").replaceWith(e.data.notificationCenter),acym_helperNotification.setNotificationCenter())})},addHeaderNotification:function(e,t){return'<div class="acym__message grid-x acym__message__'+t+'"><div class="cell auto"><p>'+e+'</p></div><i data-id="0" class="cell shrink acym__message__close acymicon-close"></i></div>'},readFullNotification:function(){jQuery(".acym__header__notification__one").off("click").on("click",function(){var e=jQuery(this).find(".acym__header__notification__message"),t=e.attr("data-acym-full");if(acym_helper.empty(t))return!0;var a=e.html();e.html(t),e.attr("data-acym-full",a)})}},acym_helperScenario={TYPE_ATTRIBUTE:"data-acym-content-type",TYPE_TRIGGER:"trigger",TYPE_DELAY:"delay",TYPE_CONDITION:"condition",TYPE_ACTION:"action",TYPE_SETTINGS:"settings",TIME_UNIT_TRANSLATION:{60:ACYM_JS_TXT.ACYM_MINUTES,3600:ACYM_JS_TXT.ACYM_HOURS,86400:ACYM_JS_TXT.ACYM_DAYS},icons:{trigger:"trigger",condition:"arrows-h",action:"action",delay:"access-time"},htmlGetter:{trigger:{containerId:"acym_scenario_triggers",inputName:"acym_scenario_triggers_input"},delay:{containerId:"acym_scenario_delay",numberInputName:"acym_scenario_delay_number",unitSelectName:"acym_scenario_delay_unit"},condition:{containerId:"acym_scenario_condition",inputName:"acym_scenario_conditions_input"},action:{containerId:"acym_scenario_action",inputName:"acym_scenario_actions_input"},settings:{containerId:"acym_scenario_settings"}},sendEmailParameters:{buttonCreate:null,stepSlugInput:null,mailIdInput:null},translation:{trigger:{},action:{},condition:{}},preOpenStepInput:null,settingsButton:null,rightPanel:null,rightPanelCloseButton:null,rightPanelContent:null,rightPanelSaveButtonFlow:null,rightPanelSaveButtonScenario:null,rightPanelCancelButton:null,rightPanelDeleteButton:null,rightPanelTitle:null,flowContainer:null,newScenarioContainer:null,chooseTriggerButton:null,baseSettingsElements:{},scenarioSettingsInputs:{name:null,active:null},currentFlow:[],cacheFlow:[],currentCachedVersion:0,currentFlowInput:null,addDropdown:null,flowParams:{},currentEditingNode:null,currentAddParentSlug:null,lastEditedNodeSlug:null,init:function(){this.setAddDropdown(),this.settingsButton=document.getElementById("acym__scenario__top__actions__configuration"),this.rightPanel=document.getElementById("acym__scenario__edit__right__panel"),this.rightPanelCloseButton=document.getElementById("acym__scenario__edit__right__panel__close"),this.rightPanelContent=document.getElementById("acym__scenario__edit__right__panel__content"),this.chooseTriggerButton=document.getElementById("acym__scenario__edit__content__new__choose__trigger"),this.rightPanelSaveButtonFlow=document.getElementById("acym__scenario__edit__right__panel__save__flow"),this.rightPanelSaveButtonScenario=document.getElementById("acym__scenario__edit__right__panel__save__scenario"),this.rightPanelCancelButton=document.getElementById("acym__scenario__edit__right__panel__cancel"),this.rightPanelDeleteButton=document.getElementById("acym__scenario__edit__right__panel__delete"),this.rightPanelTitle=document.getElementById("acym__scenario__edit__right__panel__title"),this.flowContainer=document.getElementById("acym__scenario__edit__content__flow"),this.currentFlowInput=document.getElementById("acym__scenario__edit__value"),this.newScenarioContainer=document.getElementById("acym__scenario__edit__content__new"),this.baseSettingsElements.trigger=document.querySelector("#".concat(this.htmlGetter.trigger.containerId)),this.baseSettingsElements.delay=document.querySelector("#".concat(this.htmlGetter.delay.containerId)),this.baseSettingsElements.condition=document.querySelector("#".concat(this.htmlGetter.condition.containerId)),this.baseSettingsElements.action=document.querySelector("#".concat(this.htmlGetter.action.containerId)),this.baseSettingsElements.settings=document.querySelector("#".concat(this.htmlGetter.settings.containerId)),this.scenarioSettingsInputs.name=document.querySelector('#acym_scenario_settings [name="scenario[name]"]'),this.scenarioSettingsInputs.active=document.querySelector('#acym_scenario_settings [name="scenario[active]"]'),this.sendEmailParameters.stepSlugInput=document.querySelector('#acym_scenario_action [name="send_mail[step_id]"]'),this.sendEmailParameters.mailIdInput=document.querySelector('#acym_scenario_action [name="send_mail[mail_id]"]'),this.sendEmailParameters.buttonCreate=document.querySelector('#acym_scenario_action [data-task="createMail"]'),this.preOpenStepInput=document.getElementById("acym__scenario__preopen__stepid");var e=document.getElementById("acym__scenario__edit__container").getAttribute("data-acym-step-ids"),t=e?JSON.parse(e):[];this.flowParams={id:"acym__scenario__edit__content__flow",addButtonClick:this.clickOnAdd,cardClick:this.clickOnCard,undoFunction:this.undo,redoFunction:this.redo,listOfExistingSlugs:t},this.setTranslation(),this.setupFlowFromSaved(),this.setCloseRightPanel(),this.setChooseTrigger(),this.setSaveRightPanel(),this.setAddDelay(),this.setAddCondition(),this.setAddAction(),this.setDeleteNode(),this.setSettingsButton(),this.openStepOnEditionOpen(),acym_helper.setSubmitButtonGlobal()},setTranslation:function(){var e=this,t=JSON.parse(document.getElementById("acym_scenario_triggers_data").value),a=JSON.parse(document.getElementById("acym_scenario_conditions_data").value),n=JSON.parse(document.getElementById("acym_scenario_actions_data").value);t.forEach(function(t){e.translation.trigger[t.key]=t.name.toLowerCase()}),a.forEach(function(t){e.translation.condition[t.key]=t.name.toLowerCase()}),n.forEach(function(t){e.translation.action[t.key]=t.name.toLowerCase()})},resetCurrentParentSlug:function(){this.currentAddParentSlug=null},setAddDropdown:function(){var e='<div id="acym__scenario__edit__add__overlay" style="display: none;">\n<div class="acym__scenario__edit__add__overlay__item" id="acym__scenario__edit__add__delay"><i class="acymicon-add"></i><p>'.concat(ACYM_JS_TXT.ACYM_DELAY,'</p></div>\n<div class="acym__scenario__edit__add__overlay__item" id="acym__scenario__edit__add__condition"><i class="acymicon-add"></i><p>').concat(ACYM_JS_TXT.ACYM_CONDITION,'</p></div>\n<div class="acym__scenario__edit__add__overlay__item" id="acym__scenario__edit__add__action"><i class="acymicon-add"></i><p>').concat(ACYM_JS_TXT.ACYM_ACTION,"</p></div>\n</div>");document.body.insertAdjacentHTML("beforeend",e),this.addDropdown=document.getElementById("acym__scenario__edit__add__overlay"),document.body.addEventListener("mousedown",function(e){var t="flex"===acym_helperScenario.addDropdown.style.display,a="acym__scenario__edit__add__overlay"!==e.target.id&&null===e.target.closest("#acym__scenario__edit__add__overlay");t&&a&&(acym_helperScenario.hideAddDropdown(),acym_helperScenario.resetCurrentParentSlug())})},setAddDelay:function(){var e=this;document.getElementById("acym__scenario__edit__add__delay").addEventListener("click",function(){e.hideAddDropdown(),e.displayRightPanelSettings(e.TYPE_DELAY,e.baseSettingsElements.delay)})},setAddCondition:function(){var e=this;document.getElementById("acym__scenario__edit__add__condition").addEventListener("click",function(){e.hideAddDropdown(),e.displayRightPanelSettings(e.TYPE_CONDITION,e.baseSettingsElements.condition)})},setAddAction:function(){var e=this;document.getElementById("acym__scenario__edit__add__action").addEventListener("click",function(){e.hideAddDropdown(),e.displayRightPanelSettings(e.TYPE_ACTION,e.baseSettingsElements.action)})},setTriggerLabel:function(e){return"".concat(ACYM_JS_TXT.ACYM_TRIGGER," ").concat(this.translation.trigger[e])},setWaitLabel:function(e,t){return acym_helper.sprintf(ACYM_JS_TXT.ACYM_WAIT_X_UNIT,e,this.TIME_UNIT_TRANSLATION[t])},setActionLabel:function(e){return"".concat(ACYM_JS_TXT.ACYM_ACTION," ").concat(this.translation.action[e])},setConditionLabel:function(e){return"".concat(ACYM_JS_TXT.ACYM_CONDITION," ").concat(this.translation.condition[e])},hideAddDropdown:function(){this.addDropdown.style.display="none"},setChooseTrigger:function(){var e=this;this.chooseTriggerButton.addEventListener("click",function(){e.displayRightPanelSettings(e.TYPE_TRIGGER,e.baseSettingsElements.trigger)})},displayRightPanelSettings:function(e,t){var a=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;switch(e===this.TYPE_SETTINGS?this.rightPanelSaveButtonScenario.style.display="flex":this.rightPanelSaveButtonFlow.style.display="flex",this.rightPanel.style.display="flex",this.rightPanelContent.innerHTML=t.outerHTML,this.rightPanelContent.setAttribute(this.TYPE_ATTRIBUTE,e),n&&(this.applyRightPanelParams(e,n),[this.TYPE_CONDITION,this.TYPE_ACTION,this.TYPE_DELAY].includes(e)&&(this.rightPanelDeleteButton.style.display="flex")),e){case this.TYPE_TRIGGER:this.setRightPanelCurrentOption(this.htmlGetter.trigger.inputName,"data-acym-trigger-option"),this.rightPanelTitle.innerText=ACYM_JS_TXT.ACYM_TRIGGER;break;case this.TYPE_CONDITION:this.setRightPanelCurrentOption(this.htmlGetter.condition.inputName,"data-acym-condition-option"),this.setRightPanelConditionDateOption(),this.rightPanelTitle.innerText=ACYM_JS_TXT.ACYM_CONDITION;break;case this.TYPE_ACTION:this.setRightPanelCurrentOption(this.htmlGetter.action.inputName,"data-acym-action-option"),this.setRightPanelActionSendEmail(),this.rightPanelTitle.innerText=ACYM_JS_TXT.ACYM_ACTION;break;case this.TYPE_DELAY:this.rightPanelTitle.innerText=ACYM_JS_TXT.ACYM_DELAY;break;case this.TYPE_SETTINGS:this.rightPanelTitle.innerText=ACYM_JS_TXT.ACYM_SETTINGS,this.setSettingsInputs()}this.setFunctionSettingsRightPanel(),setTimeout(function(){acym_helperScenarioRightPanel.addCloseRightPanelListener(a.closeRightPanel)},100)},setRightPanelActionSendEmail:function(){var e=this,t=this.rightPanelContent.querySelector("#acym__action__send__email__saved__id"),a=this.rightPanelContent.querySelector("#acym__action__send__email__saved");a.style.display=t.value?"flex":"none";var n=this.rightPanelContent.querySelector('[data-task="createMail"]'),i=this.rightPanelContent.querySelector("#acym__action__send__email__saved__edit");if(n){var r=function(){e.rightPanelSaveButtonFlow.click(),e.sendEmailParameters.stepSlugInput.value=e.lastEditedNodeSlug,e.sendEmailParameters.mailIdInput.value=t.value,e.sendEmailParameters.buttonCreate.click()};n.addEventListener("click",r),i&&i.addEventListener("click",r);var o=this.getNodeParams(this.currentEditingNode,this.currentFlow);if(o&&o.option.mail){var c=this.rightPanelContent.querySelector("#acym__action__send__email__saved__name");c.innerHTML=o.option.mail.name,this.rightPanelContent.querySelector("#acym__action__send__email__saved__delete").addEventListener("click",function(){t.value="",c.innerHTML="",a.style.display="none"})}}},setRightPanelCurrentOption:function(e,t){var a=this,n=function(e){a.rightPanelContent.querySelectorAll("[".concat(t,"]")).forEach(function(a){a.getAttribute(t)===e?a.style.display="flex":a.style.display="none"})},i=this.rightPanelContent.querySelector('[name="'.concat(e,'"]'));n(i.value),jQuery(i).on("change",function(){n(i.value)})},setRightPanelConditionDateOption:function(){var e=this.rightPanelContent.querySelector('[data-rs="acym_acym_conditionconditions__numor____numand__acy_listdatemin"]');if(e){e.value&&acym_helperFilter.setFieldValue(jQuery(e),e.value);var t=this.rightPanelContent.querySelector('[data-rs="acym_acym_conditionconditions__numor____numand__acy_listdatemax"]');t.value&&acym_helperFilter.setFieldValue(jQuery(t),t.value)}},closeRightPanel:function(){acym_helperScenarioRightPanel.removeCloseRightPanelListener(),acym_helperScenario.rightPanel.style.display="none",acym_helperScenario.rightPanelContent.removeAttribute(acym_helperScenario.TYPE_ATTRIBUTE),acym_helperScenario.rightPanelContent.innerHTML="",acym_helperScenario.currentEditingNode=null,acym_helperScenario.rightPanelDeleteButton.style.display="none",acym_helperScenario.rightPanelSaveButtonScenario.style.display="none",acym_helperScenario.rightPanelSaveButtonFlow.style.display="none"},setCloseRightPanel:function(){var e=this;this.rightPanelCloseButton.addEventListener("click",function(){e.closeRightPanel()}),this.rightPanelCancelButton.addEventListener("click",function(){e.closeRightPanel()})},setDeleteNode:function(){var e=this;this.rightPanelDeleteButton.addEventListener("click",function(){var t=e.getNodeParams(e.currentEditingNode,e.currentFlow);if(t){var a=e.getNode(e.currentEditingNode,e.currentFlow),n=a.children&&a.children.length>0?"ACYM_SCENARIO_ARE_YOU_SURE_DELETE_X_WITH_CHILDREN_NODES":"ACYM_SCENARIO_ARE_YOU_SURE_DELETE_X",i=acym_helper.sprintf(ACYM_JS_TXT[n],ACYM_JS_TXT[{delay:"ACYM_DELAY",condition:"ACYM_CONDITION",action:"ACYM_ACTION"}[t.type]].toLowerCase());confirm(i)&&(acym_helperFlow.deleteNode(e.currentFlow,e.currentEditingNode),e.updateCurrentFlowInput(),e.closeRightPanel(),e.displayFlow())}})},setSaveRightPanel:function(){var e=this;this.rightPanelSaveButtonFlow.addEventListener("click",function(){try{switch(e.rightPanelContent.attributes[e.TYPE_ATTRIBUTE].value){case e.TYPE_TRIGGER:e.saveTrigger();break;case e.TYPE_DELAY:e.saveDelay();break;case e.TYPE_CONDITION:e.saveCondition();break;case e.TYPE_ACTION:e.saveAction()}}catch(e){return void alert(e.message)}e.closeRightPanel()})},applyRightPanelParams:function(e,t){var a=function(e,t){var a=e.getAttribute("data-class")&&e.getAttribute("data-class").includes("acym_select2_ajax"),n=e.getAttribute("class")&&e.getAttribute("class").includes("acym_select2_ajax"),i=e.getAttribute("data-class")&&e.getAttribute("data-class").includes("acym__select"),r=e.getAttribute("class")&&e.getAttribute("class").includes("acym__select");a||n?e.setAttribute("data-selected",t):r||i?jQuery(e).val(t):e.value=t};switch(e){case this.TYPE_TRIGGER:if(a(this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.trigger.inputName,'"]')),t.trigger),t.option)for(var n in t.option){var i=this.rightPanelContent.querySelector('[name="'.concat(n,'"]'));i&&a(i,t.option[n])}break;case this.TYPE_DELAY:var r=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.delay.numberInputName,'"]')),o=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.delay.unitSelectName,'"]'));a(r,t.delay),a(o,t.unit);break;case this.TYPE_CONDITION:if(a(this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.condition.inputName,'"]')),t.condition),t.option)for(var c in t.option){var s=this.rightPanelContent.querySelector('[name="'.concat(c,'"]'));s&&a(s,t.option[c])}break;case this.TYPE_ACTION:if(a(this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.action.inputName,'"]')),t.action),t.option)for(var l in t.option){var _=this.rightPanelContent.querySelector('[name="'.concat(l,'"]'));_&&a(_,t.option[l])}}},setSettingsButton:function(){var e=this;this.settingsButton.addEventListener("click",function(){acym_helperScenario.displayRightPanelSettings(e.TYPE_SETTINGS,acym_helperScenario.baseSettingsElements.settings)})},areGeneralInformationSet:function(){return!!this.scenarioSettingsInputs.name.value||(acym_helperScenario.displayRightPanelSettings(this.TYPE_SETTINGS,acym_helperScenario.baseSettingsElements.settings),!1)},saveTrigger:function(){var e=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.trigger.inputName,'"]')),t=this.rightPanelContent.querySelector('[data-acym-trigger-option="'.concat(e.value,'"]')),a={};if(t){var n=t.querySelectorAll('[name^="[triggers][user]"]');n&&n.forEach(function(e){var t=e.getAttribute("class")&&e.getAttribute("class").includes("acym__select");a[e.name]=t?jQuery(e).val():e.value})}var i=acym_helperFlow.createNode(this.setTriggerLabel(e.value),this.icons.trigger);i.params={type:this.TYPE_TRIGGER,trigger:e.value,option:a},this.currentEditingNode&&(i.slug=this.currentEditingNode),acym_helperFlow.addUpdateNewNode(this.currentFlow,i),this.updateCurrentFlowInput(),this.displayFlow()},saveDelay:function(){var e=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.delay.numberInputName,'"]')),t=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.delay.unitSelectName,'"]')),a=this.setWaitLabel(e.value,t.value),n=acym_helperFlow.createNode(a,this.icons.delay);if(0==e.value)throw new Error(ACYM_JS_TXT.ACYM_DELAY_MUST_BE_SET);n.params={type:this.TYPE_DELAY,delay:e.value,unit:t.value},this.currentEditingNode&&(n.slug=this.currentEditingNode),acym_helperFlow.addUpdateNewNode(this.currentFlow,n,this.currentAddParentSlug),this.updateCurrentFlowInput(),this.displayFlow()},saveCondition:function(){var e=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.condition.inputName,'"]')),t=this.rightPanelContent.querySelector('[data-acym-condition-option="'.concat(e.value,'"]')),a={};if(t){var n=t.querySelectorAll('[name^="acym_condition[conditions]"]');n&&n.forEach(function(e){a[e.name]=e.value})}var i=acym_helperFlow.createNode(this.setConditionLabel(e.value),this.icons.condition,!0);i.params={type:this.TYPE_CONDITION,condition:e.value,option:a},this.currentEditingNode&&(i.slug=this.currentEditingNode),acym_helperFlow.addUpdateNewNode(this.currentFlow,i,this.currentAddParentSlug),this.updateCurrentFlowInput(),this.displayFlow()},saveAction:function(){var e=this.rightPanelContent.querySelector('[name="'.concat(this.htmlGetter.action.inputName,'"]')),t=this.rightPanelContent.querySelector('[data-acym-action-option="'.concat(e.value,'"]')),a={};if(t){var n=t.querySelectorAll('[name^="acym_action[actions]"]');n&&n.forEach(function(e){a[e.name]=e.value})}var i=acym_helperFlow.createNode(this.setActionLabel(e.value),this.icons.action);i.params={type:this.TYPE_ACTION,action:e.value,option:a},this.currentEditingNode&&(i.slug=this.currentEditingNode),this.lastEditedNodeSlug=i.slug,acym_helperFlow.addUpdateNewNode(this.currentFlow,i,this.currentAddParentSlug),this.updateCurrentFlowInput(),this.displayFlow()},displayFlow:function(){this.flowContainer.style.display="flex",this.newScenarioContainer.style.display="none",acym_helperFlow.createFlow(this.currentFlow,this.flowParams),this.updateCurrentFlowInput()},openStepOnEditionOpen:function(){if(this.preOpenStepInput.value){var e=document.querySelector("#card_".concat(this.preOpenStepInput.value));e&&e.click()}},clickOnAdd:function(e){acym_helperScenario.closeRightPanel(),acym_helperScenario.currentAddParentSlug=e;var t=document.querySelector("#".concat(e," .flow__step__card__add")).getBoundingClientRect();acym_helperScenario.addDropdown.style.top=t.top+"px",acym_helperScenario.addDropdown.style.left=t.left+t.width+10+"px",acym_helperScenario.addDropdown.style.display="flex"},clickOnCard:function(e){acym_helperScenario.closeRightPanel();var t=acym_helperScenario.getNodeParams(e,acym_helperScenario.currentFlow);if(null!==t)switch(acym_helperScenario.currentEditingNode=e,t.type){case acym_helperScenario.TYPE_TRIGGER:acym_helperScenario.displayRightPanelSettings(acym_helperScenario.TYPE_TRIGGER,acym_helperScenario.baseSettingsElements.trigger,t);break;case acym_helperScenario.TYPE_DELAY:acym_helperScenario.displayRightPanelSettings(acym_helperScenario.TYPE_DELAY,acym_helperScenario.baseSettingsElements.delay,t);break;case acym_helperScenario.TYPE_CONDITION:acym_helperScenario.displayRightPanelSettings(acym_helperScenario.TYPE_CONDITION,acym_helperScenario.baseSettingsElements.condition,t);break;case acym_helperScenario.TYPE_ACTION:acym_helperScenario.displayRightPanelSettings(acym_helperScenario.TYPE_ACTION,acym_helperScenario.baseSettingsElements.action,t)}else console.error("Node params not found for slug ".concat(e))},undo:function(){acym_helperScenario.currentCachedVersion=acym_helperScenario.getNewCurrentCacheVersion(!0),acym_helperScenario.currentFlow=JSON.parse(JSON.stringify(acym_helperScenario.cacheFlow[acym_helperScenario.currentCachedVersion])),acym_helperFlow.createFlow(acym_helperScenario.currentFlow,acym_helperScenario.flowParams)},redo:function(){acym_helperScenario.currentCachedVersion=acym_helperScenario.getNewCurrentCacheVersion(!1),acym_helperScenario.currentFlow=JSON.parse(JSON.stringify(acym_helperScenario.cacheFlow[acym_helperScenario.currentCachedVersion])),acym_helperFlow.createFlow(acym_helperScenario.currentFlow,acym_helperScenario.flowParams)},getNewCurrentCacheVersion:function(e){var t=e?acym_helperScenario.currentCachedVersion-1:acym_helperScenario.currentCachedVersion+1;return t<0||t>acym_helperScenario.cacheFlow.length-1||!acym_helperScenario.cacheFlow[t]?acym_helperScenario.currentCachedVersion:t},getNode:function(e,t){var a,n=_createForOfIteratorHelper(t);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.slug===e)return i;if(Array.isArray(i.children)){var r=this.getNode(e,i.children);if(null!==r)return r}}}catch(e){n.e(e)}finally{n.f()}return null},getNodeParams:function(e,t){var a=this.getNode(e,t);return a&&a.params?a.params:null},setFunctionSettingsRightPanel:function(){this.setSelect2(),jQuery(document).foundation(),acym_helperModal.initModal(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSwitch.setSwitchFieldsGlobal()},updateCurrentFlowInput:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentFlowInput.value=JSON.stringify(this.currentFlow),e||this.storeCacheFlow()},setupFlowFromSaved:function(){var e=document.getElementById("acym__scenario__saved__flow").value;if(e){var t=JSON.parse(e);this.createNodeFromSaved(t),this.updateCurrentFlowInput(!0),this.displayFlow()}},createNodeFromSaved:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(e.params.type){case this.TYPE_TRIGGER:t=acym_helperFlow.createNode(this.setTriggerLabel(e.params.trigger),this.icons.trigger);break;case this.TYPE_DELAY:t=acym_helperFlow.createNode(this.setWaitLabel(e.params.delay,e.params.unit),this.icons.delay);break;case this.TYPE_ACTION:t=acym_helperFlow.createNode(this.setActionLabel(e.params.action),this.icons.action);break;case this.TYPE_CONDITION:t=acym_helperFlow.createNode(this.setConditionLabel(e.params.condition),this.icons.condition,!0)}if(e.slug&&(t.slug=e.slug),t.params=e.params,acym_helperFlow.addUpdateNewNode(this.currentFlow,t,a),e.children)if(e.condition)e.children[0]&&this.createNodeFromSaved(e.children[0],t.children[0].slug),e.children[1]&&this.createNodeFromSaved(e.children[1],t.children[1].slug);else{var n,i=_createForOfIteratorHelper(e.children);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.createNodeFromSaved(r,t.slug)}}catch(e){i.e(e)}finally{i.f()}}},storeCacheFlow:function(){JSON.stringify(this.cacheFlow[this.cacheFlow.length-1])!==JSON.stringify(this.currentFlow)&&(this.currentCachedVersion<this.cacheFlow.length-1&&(this.cacheFlow=this.cacheFlow.slice(0,this.currentCachedVersion+1)),this.cacheFlow.push(JSON.parse(JSON.stringify(this.currentFlow))),this.currentCachedVersion=this.cacheFlow.length-1)},setSelect2:function(){this.rightPanelContent.querySelectorAll("[data-class]").forEach(function(e){var t;(t=e.classList).add.apply(t,_toConsumableArray(e.getAttribute("data-class").split(" "))),e.removeAttribute("data-class")}),jQuery("#acym__scenario__edit__right__panel__content .acym__select, #acym_acym_conditionconditions__numor____numand__acy_listdatemin .acym__select").select2({theme:"foundation",width:"100%"}),jQuery("#acym__scenario__edit__right__panel__content .intext_select_automation select").select2({theme:"foundation",width:"100%"}),acym_helperSelect2.setAjaxSelect2("#acym__scenario__edit__right__panel__content")},setSettingsInputs:function(){var e=this,t=this.rightPanel.querySelector('[name="scenario[name]"]');t.value=this.scenarioSettingsInputs.name.value,t.focus();var a=this.rightPanel.querySelector('[name="scenario[active]"]');a.value=this.scenarioSettingsInputs.active.value,this.rightPanelSaveButtonScenario.addEventListener("click",function(){e.scenarioSettingsInputs.name.value=t.value,e.scenarioSettingsInputs.active.value="1"===a.value?1:0,e.closeRightPanel()})}},acym_helperScenarioRightPanel={rightPanel:null,rightPanelCloseButton:null,rightPanelCancelButton:null,callback:null,addCloseRightPanelListener:function(e){this.rightPanel=document.getElementById("acym__scenario__edit__right__panel"),this.callback=e,window.addEventListener("click",acym_helperScenarioRightPanel.closePanelOnClickOutside)},removeCloseRightPanelListener:function(){window.removeEventListener("click",acym_helperScenarioRightPanel.closePanelOnClickOutside)},closePanelOnClickOutside:function(e){!["#acym__scenario__edit__right__panel","#sankey_chart_svg_container path",".reveal-overlay"].some(function(t){return e.target.closest(t)})&&document.contains(e.target)&&acym_helperScenarioRightPanel.callback()}},acym_helperSegment={filterRebuilt:!0,blocksRebuilt:!0,ajaxCalls:{},globalAjaxCall:"",reloadCounters:function(e){if(acym_helperSegment.filterRebuilt){var t=jQuery(e).closest(".acym__segments__inserted__filter").attr("data-and"),a=jQuery(e).closest("[data-filter-number]").attr("data-filter-number"),n=ACYM_AJAX_URL+"&page=acymailing_segments&ctrl=segments&task=countResults&and="+t+"&or="+a;void 0!==this.ajaxCalls[t]&&"function"==typeof this.ajaxCalls[t].abort&&this.ajaxCalls[t].abort(),jQuery("#results_"+t).find(".acym__segments__edit__filter-results").html('<i class="acymicon-circle-o-notch acymicon-spin"></i>');var i=jQuery(e).closest("#acym_form").serialize()+"&page=acymailing_segments&ctrl=segments&task=countResults&and="+t+"&or="+a;this.ajaxCalls[t]=jQuery.post(n,i).done(function(e){e=acym_helper.parseJson(e),jQuery("#results_"+t).find(".acym__segments__edit__filter-results").html(e.error?ACYM_JS_TXT.ACYM_ERROR:e.message)}).fail(function(){jQuery("#results_"+t).find(".acym__segments__edit__filter-results").html(ACYM_JS_TXT.ACYM_ERROR)}),this.reloadGlobalCounter()}},reloadGlobalCounter:function(){if(acym_helperSegment.blocksRebuilt){var e="";if(jQuery("#acym__campaigns__segment").length>0)e=jQuery("#acym__campaigns__segment__edit-user-count");else{var t=jQuery(".acym__segments__edit__filters__no-users");if(e=jQuery(".acym__segments__edit__filters__total"),0===jQuery("[name^=acym_action]").length)return t.show(),void e.hide();t.hide(),e.show()}""!==this.globalAjaxCall&&"function"==typeof this.globalAjaxCall.abort&&(this.globalAjaxCall.abort(),this.globalAjaxCall="");var a=jQuery('input[value="exclude"]:checked').length?1:0,n=jQuery(".acym__segments__group__filter"),i=ACYM_AJAX_URL+"&page=acymailing_segments&ctrl=segments&task=countResultsTotal&exclude="+a,r=n.closest("#acym_form").serialize()+"&page=acymailing_segments&ctrl=segments&task=countResultsTotal&exclude="+a;e.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),this.globalAjaxCall=jQuery.post(i,r).done(function(t){t=acym_helper.parseJson(t),e.html(t.error?ACYM_JS_TXT.ACYM_ERROR:t.message)}).fail(function(){e.html(ACYM_JS_TXT.ACYM_ERROR)})}},refreshFilterProcess:function(){this.setSelectFilters("classic"),this.setAddFilter(),this.setDeleteFilter(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),this.setAddFilterOr()},setSelectFilters:function(e){var t=jQuery("#acym__campaigns__segment").length>0,a=jQuery("#acym__segments__edit__info__options");if(a.length){var n=acym_helper.parseJson(a.val());jQuery(".acym__segments__select__"+e+"__filter").off("change").on("change",function(){t&&jQuery('[name="segment_selected"]').val("");var e=jQuery("#acym__segments__filters__count__and"),a="";0!==parseInt(e.val())&&(a='<span class="cell acym_vcenter acym__segments__delete__one__filter"><i class="acymicon-delete"></i>'.concat(ACYM_JS_TXT.ACYM_DELETE_THIS_FILTER,"</span>")),e.val(parseInt(e.val())+1);var i=acym_helperSegment.getSeeUserModalButton(jQuery(this),e.val());jQuery(this).parent().parent().find(".acym__segments__inserted__filter").remove();var r=n[jQuery(this).val()].replace(/__numor__/g,jQuery(this).closest(".acym__segments__group__filter").attr("data-filter-number"));r=r.replace(/__numand__/g,e.val());var o=t?"medium-9":"medium-6";jQuery(this).parent().after('<div data-and="'+e.val()+'" class="cell grid-x grid-margin-x grid-margin-y acym__segments__inserted__filter margin-top-1 margin-left-2 acym_vcenter"><div class="cell grid-x '+o+' grid-margin-x grid-margin-y">'+r+'</div><span class="countresults margin-bottom-1 cell auto grid-x" id="results_'+e.val()+'"><span class="acym__segments__edit__filter-results cell"></span>'+a+i+"</span></div>"),acym_helperSelect2.setSelect2(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperTooltip.setTooltip(),acym_helperFilter.setAutomationReload(),jQuery(document).foundation(),jQuery(document).trigger("acym__modal__users__summary__ready"),jQuery(".switch-label").off("click").on("click",function(){var e=jQuery('input[data-switch="'+jQuery(this).attr("for")+'"]');e.attr("value",1-e.attr("value"))});var c=jQuery(this).closest(".acym__segments__one__filter").find(".acym__automation__filters__operator__dropdown"),s=jQuery(this).closest(".acym__segments__one__filter").find(".acym__automation__filters__fields__dropdown");c.on("change",function(){s.trigger("change")}),s.on("change",function(){var e=jQuery(this).closest(".acym__segments__inserted__filter"),t=e.find('[data-filter-field="'+jQuery(this).val()+'"]'),a=e.find(".acym__automation__filters__fields__select"),n=e.find(".acym__automation__filter__regular-field");t.length>0&&("="===c.val()||"!="===c.val())?(n.attr("name",n.attr("name").replace("acym_action","")).hide(),a.each(function(e){jQuery(this).attr("name",jQuery(this).attr("name").replace("acym_action","")),jQuery(this).closest(".acym__automation__one-field").hide()}),-1===t.attr("name").indexOf("acym_action")&&t.attr("name","acym_action"+t.attr("name")),t.closest(".acym__automation__one-field").show()):(-1===n.attr("name").indexOf("acym_action")&&n.attr("name","acym_action"+n.attr("name")),a.length>0&&a.each(function(){jQuery(this).attr("name",jQuery(this).attr("name").replace("acym_action","")),jQuery(this).closest(".acym__automation__one-field").hide()}),n.show())}).trigger("change"),jQuery(this).closest(".acym__segments__one__filter.acym__segments__one__filter__classic").find(".acym__segments__inserted__filter input, .acym__segments__inserted__filter select").on("change",function(){acym_helperSegment.reloadCounters(this)}),0==jQuery(this).val()?acym_helperSegment.reloadGlobalCounter(jQuery(this).closest(".acym__segments__group__filter")):acym_helperSegment.reloadCounters(jQuery(this).closest(".acym__segments__one__filter.acym__segments__one__filter__classic").find(".acym__segments__inserted__filter input, .acym__segments__inserted__filter select, .acym__segments__inserted__filter textarea"));var l=jQuery(this).closest(".acym__segments__one__filter").find("[data-acym-toggle-filter]");acym_helperFilter.setToggle(l,"acym__segments__one__filter"),jQuery(document).foundation(),jQuery(".reveal-overlay").appendTo("#acym_form"),acym_helperSegment.refreshFilterProcess()})}},setAddFilter:function(){jQuery(".acym__segments__add-filter").off("click").on("click",function(){if(0===jQuery(this).closest(".acym__segments__group__filter").find(".acym__segments__one__filter").length){var e=jQuery("#acym__segments__and__example").clone().removeAttr("id");e.find(".acym__automation__and").remove(),jQuery(this).parent().before(e.show())}else jQuery(this).parent().before(jQuery("#acym__segments__and__example").clone().removeAttr("id").show());var t=jQuery(this).parent().prev();t.addClass("acym__segments__one__filter__"+jQuery(this).attr("data-filter-type")),t.find(".acym__segments__and__example__"+jQuery(this).attr("data-filter-type")+"__select").show().find("select").addClass("acym__select").select2({theme:"foundation",width:"100%"}),acym_helperSegment.refreshFilterProcess()})},setDeleteFilter:function(){jQuery(".acym__segments__delete__one__filter").off("click").on("click",function(){jQuery(this).closest(".acym__segments__one__filter").remove(),acym_helperSegment.reloadGlobalCounter()}),jQuery(".acym__segments__delete__one__or").off("click").on("click",function(){jQuery(this).closest(".acym__segments__or__container").remove(),acym_helperSegment.reloadGlobalCounter()})},rebuildFilters:function(){var e=jQuery("#acym__segments__filters");if(""!==e.val()){var t=acym_helper.parseJson(e.val()),a=0,n=parseInt(Object.keys(t).slice(-1)[0]);acym_helperSegment.blocksRebuilt=!1,jQuery.each(t,function(e,t){0!==a&&jQuery(".acym__automation__filters__or").trigger("click");var i=0,r=Object.keys(t).slice(-1)[0];jQuery.each(t,function(t,o){0!==i&&jQuery('.acym__segments__group__filter[data-filter-number="'+a+'"]').find(".acym__segments__add-filter[data-filter-type]").trigger("click"),acym_helperSegment.filterRebuilt=!1,jQuery.each(o,function(i,o){var c=jQuery('.acym__segments__group__filter[data-filter-number="'+a+'"]').find(".acym__segments__select__classic__filter").last();c.val(i),c.trigger("change");var s=Object.keys(o);jQuery.each(s,function(c){var l=s[c],_=o[s[c]],d=jQuery('[name^="acym_action[filters]['+a+"]["+jQuery("#acym__segments__filters__count__and").val()+"]["+i+"]["+l+']"]');acym_helperFilter.setFieldValue(d,_),c===s.length-1&&(acym_helperSegment.filterRebuilt=!0,r===t&&n===parseInt(e)&&(acym_helperSegment.blocksRebuilt=!0)),d.trigger("change")})}),i++}),a++}),this.refreshFilterProcess()}},setAddFilterOr:function(){jQuery(".acym__automation__filters__or").off("click").on("click",function(){var e=jQuery("#acym__automation__filters__count__or");e.val(parseInt(e.val())+1),jQuery(this).before(jQuery("#acym__automation__or__example").html());var t=jQuery(this).prev();t.find(".acym__segments__group__filter").attr("data-filter-number",e.val()),acym_helperSegment.refreshFilterProcess(),t.find("button[data-filter-type]").trigger("click"),"classic"===jQuery(this).attr("data-filter-type")&&acym_helperSegment.reloadGlobalCounter(t)})},getSeeUserModalButton:function(e,t){var a="acym__segments__see-users__".concat(t),n=jQuery("#acym__segment__see-users__example").clone(),i=jQuery("#acym__segments__see-users").closest(".reveal-overlay").clone();n.find('[data-open="acym__segments__see-users"]').attr("data-open",a),i.find("#acym__segments__see-users").attr("id",a);var r={ctrl:"segments",task:"usersSummary",and:t,or:e.closest("[data-filter-number]").attr("data-filter-number")};i.find("[acym-data-query]").attr("acym-data-query",JSON.stringify(r));var o=n.html()+i[0].outerHTML;return'<span class="cell shrink acym__segments__see-users">'.concat(o,"</span>")}},acym_helperSelect2={initJsSelect2:function(){this.setSelect2(),this.setAjaxSelect2(),this.setSelect2Email(),this.setSelect2ChooseTagsGlobal()},setSelect2:function(){jQuery(".acym__select:not([acym-data-infinite])").select2({theme:"foundation",width:"100%"}),jQuery(".acym__select[acym-data-infinite]").select2({theme:"foundation",width:"100%",minimumResultsForSearch:1/0}),jQuery(".intext_select").select2({theme:"foundation",minimumResultsForSearch:1/0})},setAjaxSelect2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";jQuery("".concat(e," .acym_select2_ajax")).each(function(){var e=jQuery(this).attr("data-placeholder");e||(e="- - -");var t=jQuery(this).attr("data-ctrl");t||(t="dynamics");var a=jQuery(this).attr("data-task");a||(a="trigger");var n=jQuery(this).attr("acym-data-default"),i={ctrl:t,task:a},r=jQuery(this).attr("data-params");if(r){var o=acym_helper.parseJson(r);Object.assign(i,o)}var c=jQuery(this).attr("data-min");c||(c=3),jQuery(this).select2({theme:"foundation",ajax:{url:ACYM_AJAX_URL,dataType:"json",delay:250,data:function(e){return i.search=e.term,i},processResults:function(e){var t=[];return void 0===n||""!==i.search&&void 0!==i.search||t.push({id:0,text:n}),e&&jQuery.each(e,function(e,a){t.push({id:a[0],text:a[1]})}),{results:t}},cache:!0},minimumInputLength:c,width:"100%",allowClear:!0,placeholder:e});var s=jQuery(this).attr("data-selected");if(void 0!==s){var l=ACYM_AJAX_URL+"&ctrl="+t+"&task="+a+"&id="+encodeURIComponent(s),_=jQuery(this);void 0!==i.plugin&&void 0!==i.trigger&&(l+="&plugin=".concat(i.plugin,"&trigger=").concat(i.trigger)),jQuery.get(l,function(e){if(e=acym_helper.parseJson(e),Array.isArray(e))e.map(function(e,t){var a=new Option(e.text,e.value,!1,!0);_.append(a)});else{var t=new Option(e.text,e.value,!1,!1);_.append(t)}})}})},setSelect2Email:function(){var e=jQuery(".acym__multiselect__email"),t={ctrl:"campaigns",task:"searchTestReceiversAjax"};e.select2({width:"100%",placeholder:e.attr("placeholder"),tags:!0,theme:"foundation",tokenSeparators:[" ",",",";"],createTag:function(e){var t=jQuery.trim(e.term);return acym_helper.emailValid(t)?{id:t,text:t}:null},ajax:{url:ACYM_AJAX_URL,dataType:"json",delay:250,data:function(e){return t.search=e.term,t},processResults:function(t){var a=[];return t&&jQuery.each(t,function(t,n){var i=n[0];e.length>1&&(i=n[1]),a.push({id:i,text:n[1]})}),{results:a}}},minimumInputLength:3})},setSelect2ChooseTagsGlobal:function(){var e=jQuery("#acym__tags__field"),t=e.attr("placeholder");e.select2({width:"100%",placeholder:t,tags:!0,theme:"foundation",tokenSeparators:[" "],createTag:function(e){var t=jQuery.trim(e.term);return""===t?null:{id:"acy_new_tag_"+t,text:t,newTag:!0}}})}},acym_helperStats={setLineChartOpenTimeWeek:function(){if(null!==document.getElementById("acym__stats__global__open-time__data")){var e=document.getElementById("acym__stats__global__open-time__data").value;if(void 0!==e){e=acym_helper.parseJson(e);var t,a,n={sunday:[],other:[]},i={sunday:[],other:[]},r={0:ACYM_JS_TXT.ACYM_SUNDAY,1:ACYM_JS_TXT.ACYM_MONDAY,2:ACYM_JS_TXT.ACYM_TUESDAY,3:ACYM_JS_TXT.ACYM_WEDNESDAY,4:ACYM_JS_TXT.ACYM_THURSDAY,5:ACYM_JS_TXT.ACYM_FRIDAY,6:ACYM_JS_TXT.ACYM_SATURDAY},o={1:"3h",2:"6h",3:"9h",4:"12h",5:"15h",6:"18h",7:"21h"};e.map(function(e,t){var a=0===t?"sunday":"other";e.map(function(e,c){0===c?n[a].push(r[t]):n[a].push(o[c]),i[a].push(e)})}),t=n.other.concat(n.sunday),a=i.other.concat(i.sunday);new Chart(document.getElementById("chartjs-0"),{type:"line",data:{labels:t,datasets:[{label:ACYM_JS_TXT.ACYM_OPEN_PERCENTAGE,data:a,fill:!1,borderColor:"rgb(0, 165, 255)",lineTension:.1}]},options:{responsive:!0,legend:{display:!1},maintainAspectRatio:!1,tooltips:{backgroundColor:"#fff",borderWidth:2,borderColor:"#303e46",titleFontSize:16,titleFontColor:"#303e46",bodyFontColor:"#303e46",bodyFontSize:14,displayColors:!1},scales:{yAxes:[{gridLines:{display:!1},ticks:{display:!0,fontColor:"#0a0a0a"}}],xAxes:[{gridLines:{display:!1},ticks:{display:!0,fontSize:14,fontColor:"#0a0a0a"}}]}}})}}}},acym_helperWorkflow={init:function(){this.setClick(),this.setHover()},setClick:function(){var e=document.getElementsByClassName("acym__workflow__step");if(e)for(var t=function(t){e[t];if(e[t].classList.contains("acym__workflow__step__disabled"))return 1;e[t].addEventListener("click",function(){var a=e[t].querySelector("a");a&&a.click()})},a=0;a<e.length;a++)t(a)},setHover:function(){var e=document.getElementsByClassName("acym__workflow__step");if(e)for(var t=function(t){if(e[t].classList.contains("acym__workflow__step__disabled"))return 1;e[t].addEventListener("mouseover",function(){var a=t-1>=0?e[t-1]:null,n=e[t],i=t+1<=e.length?e[t+1]:null;a&&(a.classList.add("acym__workflow__step__hover__right"),n.classList.add("acym__workflow__step__hover__left")),i&&(i.classList.add("acym__workflow__step__hover__left"),n.classList.add("acym__workflow__step__hover__right")),e[t].addEventListener("mouseout",function(){n.classList.remove("acym__workflow__step__hover__right"),n.classList.remove("acym__workflow__step__hover__left"),a&&a.classList.remove("acym__workflow__step__hover__right"),i&&i.classList.remove("acym__workflow__step__hover__left")})})},a=0;a<e.length;a++)t(a)}};