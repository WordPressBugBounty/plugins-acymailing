jQuery(function(t){function o(){n("classic"),n("user"),t(".acym__automation__add-condition").off("click").on("click",function(){let n=t(this).closest(".acym__automation__group__condition").find(".acym__automation__one__condition").length;if(0===n){let o=t("#acym__automation__and__example").clone().removeAttr("id");o.find(".acym__automation__and").remove(),t(this).parent().before(o.show())}else t(this).parent().before(t("#acym__automation__and__example").clone().removeAttr("id").show());let i=t(this).parent().prev();i.addClass("acym__automation__one__condition__"+t(this).attr("data-condition-type")),i.find(".acym__automation__and__example__"+t(this).attr("data-condition-type")+"__select").show().find("select").addClass("acym__select").select2({theme:"foundation",width:"100%"}),o()}),t(".acym__automation__choose__condition").off("click").on("click",function(){t("#acym__automation__type-condition__input").val(t(this).attr("data-condition")),t(".selected-condition").removeClass("selected-condition"),t(this).addClass("selected-condition");let o=t(".acym__automation__condition__container");o.hide(),o.find('[name^="type_condition"]').each(function(o){t(this).attr("name",t(this).attr("name").replace("type_condition",""))});let n=t("#acym__automation__conditions__type__"+t(this).attr("data-condition"));n.show(),n.find('[name^="[conditions]"]').each(function(o){t(this).attr("name","type_condition"+t(this).attr("name"))})}),t(".acym__automation__conditions__or").off("click").on("click",function(){let n=t("#acym__automation__conditions__count__or");n.val(parseInt(n.val())+1),t(this).before(t("#acym__automation__or__example").html());let i=t(this).prev();i.attr("data-condition-number",n.val()),o(),i.find("button[data-condition-type]").attr("data-condition-type",t(this).attr("data-condition-type")).trigger("click")}),t(".acym__automation__delete__one__condition").off("click").on("click",function(){t(this).closest(".acym__automation__one__condition").remove()}),t(".acym__automation__delete__group__condition").off("click").on("click",function(){let o=t(this).closest(".acym__automation__group__condition");o.prev().remove(),o.remove()}),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),acym_helperFilter.setAutomationReload()}function n(n){let i=t("#acym__automation__condition__"+n+"__options");if(!i.length)return;let a=acym_helper.parseJson(i.val());t(".acym__automation__select__"+n+"__condition").off("change").on("change",function(){let n=t("#acym__automation__conditions__count__and");n.val(parseInt(n.val())+1),t(this).parent().parent().find(".acym__automation__inserted__condition").remove();let i=a[t(this).val()].replace(/__numor__/g,t(this).closest(".acym__automation__group__condition").attr("data-condition-number"));i=i.replace(/__numand__/g,n.val()),t(this).parent().after('<div data-and="'+n.val()+'" class="cell grid-x grid-margin-x margin-y acym__automation__inserted__condition margin-top-1 margin-left-2 margin-right-2">'+i+"</div>"),acym_helperSelect2.setSelect2(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperTooltip.setTooltip(),t(".switch-label").off("click").on("click",function(){const o=t('input[data-switch="'+t(this).attr("for")+'"]');o.attr("value",1-o.attr("value"))});const _=t(this).closest(".acym__automation__one__condition").find(".acym__automation__conditions__operator__dropdown"),e=t(this).closest(".acym__automation__one__condition").find(".acym__automation__conditions__fields__dropdown");_.on("change",function(){e.trigger("change")}),e.on("change",function(){const o=t(this).closest(".acym__automation__inserted__condition"),n=o.find('[data-condition-field="'+t(this).val()+'"]'),i=o.find(".acym__automation__conditions__fields__select"),a=o.find(".acym__automation__condition__regular-field");n.length>0&&["=","!="].includes(_.val())?(a.attr("name",a.attr("name").replace("acym_condition","")).hide(),i.each(function(o){t(this).attr("name",t(this).attr("name").replace("acym_condition","")),t(this).closest(".acym__automation__one-field").hide()}),n.attr("name").includes("acym_condition")||n.attr("name","acym_condition"+n.attr("name")),n.closest(".acym__automation__one-field").show()):(a.attr("name").includes("acym_condition")||a.attr("name","acym_condition"+a.attr("name")),i.length>0&&i.each(function(){t(this).attr("name",t(this).attr("name").replace("acym_condition","")),t(this).closest(".acym__automation__one-field").hide()}),a.show())}).trigger("change"),t(document).foundation(),t(".reveal-overlay").appendTo("#acym_form"),o()})}o(),function(){let n=t("#conditions");if(!n.length)return;let i=acym_helper.parseJson(n.val()),a=i.type_condition,_=0;t.each(i,function(o,n){let i=0;if("type_condition"===o)return!0;0!==_&&t('.acym__automation__conditions__or[data-condition-type="'+a+'"]').trigger("click"),t.each(n,function(o,n){0!==i&&t('.acym__automation__group__condition[data-condition-number="'+_+'"]').find('.acym__automation__add-condition[data-condition-type="'+a+'"]').trigger("click"),t.each(n,function(o,n){let i=t('.acym__automation__group__condition[data-condition-number="'+_+'"]').find(".acym__automation__select__"+a+"__condition").last();i.val(o),i.trigger("change");let e=Object.keys(n);t.each(e,function(i){let a=e[i],c=n[e[i]],d=t('[name^="acym_condition[conditions]['+_+"]["+t("#acym__automation__conditions__count__and").val()+"]["+o+"]["+a+']"]');acym_helperFilter.setFieldValue(d,c),d.trigger("change")})}),i++}),_++}),o()}(),t.cleanCondition=function(){const o={};t(".acym__automation__choose__condition").each((n,i)=>{o[i.getAttribute("data-condition")]=t(`#acym__automation__conditions__type__${i.getAttribute("data-condition")}`)});const n=t(".acym__automation__choose__condition:not(.selected-condition)").attr("data-condition");return t(o[n]).find('[name^="acym_condition"]').remove(),!0}});