jQuery(function(e){const t={scenarioId:null,stepId:null,type:null,page:null,search:null};let n={};function a(){!function(){const e=document.getElementById("acym_pagination"),n=document.getElementsByClassName("acym__pagination__page");if(!e)return;e.addEventListener("change",()=>{t.page=e.value,c()});for(let e=0;e<n.length;e++)n[e].addEventListener("click",function(){t.page=this.getAttribute("page"),c()})}(),function(){const e=document.getElementsByClassName("acym__scenario__performance__trigger__user");for(let a=0;a<e.length;a++)e[a].addEventListener("click",function(){n=JSON.parse(JSON.stringify(t)),i(this.getAttribute("data-acym-user-id"),this.getAttribute("data-acym-process-id"))})}(),function(){const e=document.getElementById("acym__scenario__performance__step__search");if(!e)return;let n=null;e.addEventListener("input",function(){clearTimeout(n),n=setTimeout(()=>{t.search=e.value,c()},500)})}(),function(){const e=document.getElementById("acym__scenario__performance__user__back");if(!e)return;e.addEventListener("click",function(){for(let e in t)null!==n[e]&&(t[e]=n[e]);n={},c()})}()}function i(e,t){const n=document.getElementById("acym__scenario__edit__right__panel__content");if(!e||!t||!n)return;r(!0);const i={ctrl:"scenarios",task:"getUserInfo",userId:e,processId:t};acym_helper.get(ACYM_AJAX_URL,i).then(e=>{r(!1),e.error||(n.innerHTML=e.data.content,a())})}function c(){const e=document.getElementById("acym__scenario__edit__right__panel__content");if(!e)return;r(!0);const n={ctrl:"scenarios",task:"getStepStats",scenarioId:t.scenarioId,stepId:t.stepId,type:t.type,page:t.page,search:t.search};acym_helper.get(ACYM_AJAX_URL,n).then(t=>{r(!1),t.error||(e.innerHTML=t.data.content,a())})}function r(e){const t=document.getElementById("acym__scenario__edit__right__panel__content");t&&(t.innerHTML=e?'<div id="acym__scenario__edit__right__panel__content__loader"><i class="acymicon-circle-o-notch acymicon-spin"></i></div>':"")}function o(){acym_helperScenarioRightPanel.removeCloseRightPanelListener();const e=document.getElementById("acym__scenario__edit__right__panel"),a=document.getElementById("acym__scenario__edit__right__panel__content");e&&a&&(e.style.display="none",a.innerHTML="",function(){for(let e in t)t[e]=null;n={}}())}!function(){const e=document.getElementById("acym__scenario__performances__chart-data"),n=document.getElementById("acym__scenario__performances__chart-nodes");if(!e||!n)return;let a,i;try{a=JSON.parse(e.value),i=JSON.parse(n.value)}catch(e){return void console.error("Error parsing JSON:",e)}if(!a||!Array.isArray(a)||0===a.length)return void console.warn("Empty or invalid links data");if(!i||0===Object.keys(i).length)return void console.warn("Empty or invalid nodes data");const r=a.map(e=>({source:String(e.source),target:String(e.target),value:e.value})).filter(e=>{const t=void 0!==i[e.source],n=void 0!==i[e.target];return t&&n||console.warn("Link with missing node:",e),t&&n});if(0===r.length)return void console.warn("No valid link found");const _={};for(const[e,t]of Object.entries(i))_[e]=t.name;SankeyChart.display({id:"acym__scenario__performances__sankey",data:r,labels:_,nodeClickCallback:function(e,n){i[e]&&function(e){const n=document.getElementById("acym__scenario__edit__right__panel"),a=document.getElementById("acym__scenario__edit__right__panel__title");n&&a&&e.type&&e.scenarioId&&void 0!==e.stepId&&("flex"!==n.style.display||t.scenarioId!==e.scenarioId||t.stepId!==e.stepId||t.type!==e.type?(acym_helperScenarioRightPanel.removeCloseRightPanelListener(),t.scenarioId=e.scenarioId,t.stepId=e.stepId,t.type=e.type,c(),a.innerText=e.name,n.style.display="flex",setTimeout(()=>{acym_helperScenarioRightPanel.addCloseRightPanelListener(o)},150)):o())}(i[e])},interactive:!0,iterationHidden:3,interactiveOn:"link"})}(),function(){const e=document.getElementById("acym__scenario__edit__right__panel__close");e&&e.addEventListener("click",()=>{o()})}()});